var e="\n  (function() {\n    // 捕获全局错误（包括资源加载错误）\n    window.addEventListener('error', function(event) {\n      if (window.parent && window.parent !== window) {\n        const errorData = {\n          type: event.type,\n          message: event.message,\n          filename: event.filename,\n          lineno: event.lineno,\n          colno: event.colno,\n          timeStamp: event.timeStamp\n        };\n        \n        // Error 对象（JavaScript 运行时错误）\n        if (event.error) {\n          errorData.error = {\n            message: event.error.message,\n            stack: event.error.stack,\n            name: event.error.name\n          };\n        }\n        \n        // Target 信息（资源加载错误）\n        if (event.target && event.target !== window) {\n          errorData.target = {\n            tagName: event.target.tagName,\n            src: event.target.src,\n            href: event.target.href\n          };\n        }\n        \n        window.parent.postMessage({\n          type: 'CONSOLE_ERROR',\n          error: errorData,\n          timestamp: new Date().toISOString()\n        }, '*');\n      }\n    }, true);\n\n    // 捕获Promise错误\n    window.addEventListener('unhandledrejection', function(event) {\n      if (window.parent && window.parent !== window) {\n        const errorData = {\n          type: event.type,\n          timeStamp: event.timeStamp\n        };\n        \n        // 序列化 reason\n        if (event.reason) {\n          if (typeof event.reason === 'object' && event.reason !== null) {\n            errorData.reason = {\n              message: event.reason.message,\n              stack: event.reason.stack,\n              name: event.reason.name\n            };\n          } else {\n            errorData.reason = String(event.reason);\n          }\n        }\n        \n        window.parent.postMessage({\n          type: 'CONSOLE_ERROR',\n          error: errorData,\n          timestamp: new Date().toISOString()\n        }, '*');\n      }\n    });\n  })();\n";function n(n){return n.replace("</head>","<script>".concat(e,"</script></head>"))}var r=function(){return{name:"error-capture",apply:"serve",transformIndexHtml:{order:"pre",handler:function(e){return n(e)}}}},t=function(){return{name:"ice-error-capture",setup:function(n){var r=n.onGetConfig;console.log("\uD83D\uDE80 Error capture plugin: Plugin setup started"),r(function(n){"production"!==n.mode&&(n.transformPlugins=n.transformPlugins||[],n.transformPlugins.push({name:"error-capture-transform",transform:function(n,r){if(r.endsWith("document.tsx")||r.includes("document.tsx")){if(n.includes("data-error-capture"))return n;var t='\n        <script \n          data-error-capture="true"\n          dangerouslySetInnerHTML={{\n            __html: `'.concat(e,"`\n          }}\n        />"),a=n,o=n.match(/<head[^>]*>/i);return o&&(a=n.replace(o[0],"".concat(o[0],"\n        ").concat(t))),a}return n}}))})}}},a=function(){if("undefined"!=typeof document){var n=document.createElement("script");n.innerHTML=e,document.head.appendChild(n)}};"undefined"!=typeof window&&a();var o={viteAdapter:r,iceAdapter:t,injectErrorCaptureScript:a,injectErrorScript:n};export{o as default,t as iceAdapter,a as injectErrorCaptureScript,n as injectErrorScript,r as viteAdapter};
