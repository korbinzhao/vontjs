# DOMå®¡æŸ¥å™¨æ³¨å…¥æ’ä»¶

ä¸€ä¸ªå¼ºå¤§çš„DOMå…ƒç´ å®¡æŸ¥å’Œè°ƒè¯•å·¥å…·ï¼Œæ”¯æŒå¤šç§æ„å»ºå·¥å…·çš„è‡ªåŠ¨æ³¨å…¥ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¯ **å…ƒç´ é«˜äº®é€‰æ‹©** - é¼ æ ‡æ‚¬åœå’Œç‚¹å‡»é€‰æ‹©å…ƒç´ 
- ğŸ“ **å¤šç§é€‰æ‹©å™¨ç”Ÿæˆ** - è‡ªåŠ¨ç”ŸæˆXPathå’ŒCSSé€‰æ‹©å™¨
- ğŸ—ºï¸ **æºç æ˜ å°„æ”¯æŒ** - è·å–å…ƒç´ çš„æºç æ–‡ä»¶ä½ç½®ä¿¡æ¯
- ğŸ”§ **å¤šæ¡†æ¶é€‚é…** - æ”¯æŒViteã€Webpackã€Rollupã€Next.jsç­‰
- ğŸ“¡ **è·¨çª—å£é€šä¿¡** - æ”¯æŒiframeç¯å¢ƒä¸‹çš„æ¶ˆæ¯ä¼ é€’
- ğŸ® **APIæ§åˆ¶** - æä¾›å®Œæ•´çš„JavaScript APIæ§åˆ¶

## å®‰è£…

```bash
npm install @ali/aone-super-dom-inspector-injector
```

## ä½¿ç”¨æ–¹æ³•

### 1. Viteæ’ä»¶ï¼ˆé»˜è®¤ï¼‰

```javascript
// vite.config.js
import domInspector from '@ali/aone-super-dom-inspector-injector';

export default {
  plugins: [
    domInspector()
  ]
};
```

### 2. Iceæ¡†æ¶

```javascript
// ice.config.mts
import { iceAdapter } from '@ali/aone-super-dom-inspector-injector';

export default {
  plugins: [
    iceAdapter()
  ]
};
```

### 3. Webpackæ’ä»¶

```javascript
// webpack.config.js
import { webpackAdapter } from '@ali/aone-super-dom-inspector-injector';

module.exports = {
  plugins: [
    webpackAdapter()
  ]
};
```

### 4. Rollupæ’ä»¶

```javascript
// rollup.config.js
import { rollupAdapter } from '@ali/aone-super-dom-inspector-injector';

export default {
  plugins: [
    rollupAdapter()
  ]
};
```

### 5. Next.jsæ’ä»¶

```javascript
// next.config.js
import { nextjsAdapter } from '@ali/aone-super-dom-inspector-injector';

export default {
  plugins: [
    nextjsAdapter()
  ]
};
```

### 6. æ‰‹åŠ¨æ³¨å…¥

```javascript
import { injectDOMInspectorScript, DOMInspectorAPI } from '@ali/aone-super-dom-inspector-injector';

// æ‰‹åŠ¨æ³¨å…¥è„šæœ¬
injectDOMInspectorScript();

// ä½¿ç”¨APIæ§åˆ¶
DOMInspectorAPI.startInspection(); // å¼€å§‹å®¡æŸ¥æ¨¡å¼
DOMInspectorAPI.stopInspection();  // åœæ­¢å®¡æŸ¥æ¨¡å¼
DOMInspectorAPI.clearHighlight();  // æ¸…é™¤é«˜äº®

// ç›‘å¬å…ƒç´ é€‰æ‹©äº‹ä»¶
const cleanup = DOMInspectorAPI.onElementSelected((elementInfo) => {
  console.log('é€‰ä¸­çš„å…ƒç´ :', elementInfo);
  // elementInfoåŒ…å«ï¼š
  // - tagName: æ ‡ç­¾å
  // - className: ç±»å
  // - id: ID
  // - textContent: æ–‡æœ¬å†…å®¹
  // - attributes: æ‰€æœ‰å±æ€§
  // - xpath: XPathè·¯å¾„
  // - cssSelector: CSSé€‰æ‹©å™¨
  // - sourceInfo: æºç æ˜ å°„ä¿¡æ¯
});

// æ¸…ç†ç›‘å¬å™¨
cleanup();
```

### 7. æµè§ˆå™¨ç›´æ¥å¼•å…¥

#### æ–¹å¼1: UMDæ ¼å¼å¼•å…¥ (æ¨è)

```html
<!-- å¼•å…¥UMDæ„å»ºç‰ˆæœ¬ -->
<script src="https://unpkg.com/@ali/aone-super-dom-inspector-injector/dist/index.umd.es5.production.js"></script>

<script>
// ä½¿ç”¨è‡ªåŠ¨åˆ›å»ºçš„å…¨å±€å®ä¾‹
window.domInspector.start(); // å¼€å§‹å®¡æŸ¥
window.domInspector.stop();  // åœæ­¢å®¡æŸ¥
window.domInspector.clear(); // æ¸…é™¤é«˜äº®

// ç›‘å¬å…ƒç´ é€‰æ‹©äº‹ä»¶
window.domInspector.onElementSelected((detail) => {
  console.log('é€‰ä¸­å…ƒç´ :', detail.elementInfo);
  console.log('å…ƒç´ ä½ç½®:', detail.elementRect);
});

// æˆ–è€…åˆ›å»ºæ–°çš„å®ä¾‹
const inspector = new window.DOMInspectorInjector();
inspector.start();
</script>
```

#### æ–¹å¼2: æœ¬åœ°æ–‡ä»¶å¼•å…¥

```html
<!-- ä¸‹è½½UMDæ–‡ä»¶åˆ°æœ¬åœ° -->
<script src="./dom-inspector.umd.js"></script>

<script>
// ä½¿ç”¨æ–¹å¼ä¸CDNç›¸åŒ
window.domInspector.start();
</script>
```

#### æ–¹å¼3: ESæ¨¡å—å¼•å…¥

```html
<script type="module">
import { DOMInspectorInjector } from '@ali/aone-super-dom-inspector-injector';

const inspector = new DOMInspectorInjector();
inspector.start();
</script>
```

## APIå‚è€ƒ

### DOMInspectorAPI

#### startInspection()
å¼€å§‹DOMå®¡æŸ¥æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡é¼ æ ‡æ‚¬åœå’Œç‚¹å‡»é€‰æ‹©å…ƒç´ ã€‚

#### stopInspection()
åœæ­¢DOMå®¡æŸ¥æ¨¡å¼ï¼Œæ¢å¤æ­£å¸¸é¡µé¢äº¤äº’ã€‚

#### clearHighlight()
æ¸…é™¤å½“å‰é«˜äº®çš„å…ƒç´ ã€‚

#### onElementSelected(callback)
ç›‘å¬å…ƒç´ é€‰æ‹©äº‹ä»¶ã€‚

**å‚æ•°:**
- `callback: (elementInfo: ElementInfo) => void` - å…ƒç´ é€‰æ‹©å›è°ƒå‡½æ•°

**è¿”å›å€¼:**
- `() => void` - æ¸…ç†å‡½æ•°ï¼Œç”¨äºç§»é™¤äº‹ä»¶ç›‘å¬å™¨

### ElementInfo å¯¹è±¡ç»“æ„

```typescript
interface ElementInfo {
  tagName: string;        // æ ‡ç­¾åï¼ˆå°å†™ï¼‰
  className: string;      // ç±»å
  id: string;            // ID
  textContent: string;   // æ–‡æœ¬å†…å®¹ï¼ˆå‰100å­—ç¬¦ï¼‰
  attributes: Record<string, string>; // æ‰€æœ‰HTMLå±æ€§
  xpath: string;         // XPathè·¯å¾„
  cssSelector: string;   // CSSé€‰æ‹©å™¨
  sourceInfo?: {         // æºç æ˜ å°„ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    file: string;        // æºç æ–‡ä»¶è·¯å¾„
    line: number;        // è¡Œå·
    column: number;      // åˆ—å·
    component: string;   // ç»„ä»¶å
  };
}
```

## æ¶ˆæ¯é€šä¿¡

æ’ä»¶ä½¿ç”¨`postMessage`è¿›è¡Œè·¨çª—å£é€šä¿¡ï¼Œæ”¯æŒä»¥ä¸‹æ¶ˆæ¯ç±»å‹ï¼š

### å‘é€åˆ°é¡µé¢
- `START_INSPECTION` - å¼€å§‹å®¡æŸ¥æ¨¡å¼
- `STOP_INSPECTION` - åœæ­¢å®¡æŸ¥æ¨¡å¼
- `CLEAR_HIGHLIGHT` - æ¸…é™¤é«˜äº®

### ä»é¡µé¢æ¥æ”¶
- `ELEMENT_SELECTED` - å…ƒç´ è¢«é€‰ä¸­

```javascript
// ç›‘å¬é¡µé¢æ¶ˆæ¯
window.addEventListener('message', (event) => {
  if (event.data.type === 'ELEMENT_SELECTED') {
    console.log('é€‰ä¸­å…ƒç´ :', event.data.data);
    console.log('å…ƒç´ ä½ç½®:', event.data.elementRect);
  }
});
```

## æºç æ˜ å°„æ”¯æŒ

æ’ä»¶ä¼šè‡ªåŠ¨æŸ¥æ‰¾å…ƒç´ çš„æºç æ˜ å°„ä¿¡æ¯ï¼Œæ”¯æŒä»¥ä¸‹å±æ€§ï¼š

- `data-source-file` - æºç æ–‡ä»¶è·¯å¾„
- `data-source-line` - æºç è¡Œå·
- `data-source-column` - æºç åˆ—å·
- `data-source-component` - ç»„ä»¶å

å¦‚æœå…ƒç´ æœ¬èº«æ²¡æœ‰è¿™äº›å±æ€§ï¼Œæ’ä»¶ä¼šå‘ä¸Šéå†çˆ¶å…ƒç´ æŸ¥æ‰¾ã€‚

## æ³¨æ„äº‹é¡¹

1. æ’ä»¶ä¼šè‡ªåŠ¨é˜²æ­¢é‡å¤æ³¨å…¥
2. åœ¨iframeç¯å¢ƒä¸­éœ€è¦ç¡®ä¿è·¨åŸŸæ¶ˆæ¯ä¼ é€’æƒé™
3. æºç æ˜ å°„ä¿¡æ¯éœ€è¦æ„å»ºå·¥å…·æ”¯æŒå¹¶æ­£ç¡®é…ç½®
4. å»ºè®®åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒè¯·ç§»é™¤

## è®¸å¯è¯

MIT
